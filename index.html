
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Today's Focus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2em;
      background: #e0f7fa;
    }
    input, button {
      padding: 1em;
      margin: 0.5em;
      font-size: 1em;
    }
    .task {
      margin: 0.5em 0;
      font-size: 1.2em;
      background: white;
      padding: 1em;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      position: relative;
      user-select: none;
      touch-action: none;
      transition: opacity 2s ease-out;
    }
    .completed {
      text-decoration: line-through;
      color: gray;
      opacity: 0;
    }
    .editing input {
      font-size: 1.2em;
      width: 90%;
      padding: 0.5em;
    }
    #inputSection {
      display: block;
    }
  </style>
</head>
<body>
  <h1>What Are You Working On Today?</h1>
  <div id="inputSection">
    <input type="text" id="taskInput" placeholder="Enter task (max 6 visible)">
    <br>
    <button onclick="addTask()">Add Task</button>
  </div>
  <button onclick="clearTasks()">Clear All</button>
  <div id="taskList"></div>

  <script>
    let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    let completed = JSON.parse(localStorage.getItem("completed")) || [];
    const taskList = document.getElementById("taskList");
    const inputSection = document.getElementById("inputSection");

    function saveTasks() {
      localStorage.setItem("tasks", JSON.stringify(tasks));
      localStorage.setItem("completed", JSON.stringify(completed));
    }

    function renderTasks() {
      taskList.innerHTML = "";
      tasks.forEach((task, index) => {
        if (!completed[index]) {
          const div = document.createElement("div");
          div.className = "task";
          div.textContent = task;
          div.dataset.index = index;

          // Swipe detection and long press for editing
          let startX = 0;
          let longPressTimer;

          div.addEventListener("touchstart", (e) => {
            startX = e.touches[0].clientX;
            longPressTimer = setTimeout(() => startEdit(index), 500);
          });
          div.addEventListener("touchend", (e) => {
            clearTimeout(longPressTimer);
            const endX = e.changedTouches[0].clientX;
            const dx = endX - startX;
            if (Math.abs(dx) > 50) {
              div.classList.add("completed");
              setTimeout(() => {
                completed[index] = true;
                saveTasks();
                renderTasks();
              }, 2000);
            }
          });

          let mouseStart = 0;
          div.addEventListener("mousedown", (e) => {
            mouseStart = e.clientX;
            longPressTimer = setTimeout(() => startEdit(index), 500);
          });
          div.addEventListener("mouseup", (e) => {
            clearTimeout(longPressTimer);
            const dx = e.clientX - mouseStart;
            if (Math.abs(dx) > 50) {
              div.classList.add("completed");
              setTimeout(() => {
                completed[index] = true;
                saveTasks();
                renderTasks();
              }, 2000);
            }
          });

          taskList.appendChild(div);
        }
      });

      const visibleCount = completed.filter(c => !c).length;
      inputSection.style.display = visibleCount >= 6 ? "none" : "block";
    }

    function startEdit(index) {
      const taskElements = document.querySelectorAll(".task");
      let targetEl;
      taskElements.forEach(el => {
        if (+el.dataset.index === index) {
          targetEl = el;
        }
      });

      if (!targetEl) return;

      const oldText = tasks[index];
      const input = document.createElement("input");
      input.type = "text";
      input.value = oldText;

      const saveEdit = () => {
        tasks[index] = input.value.trim() || oldText;
        saveTasks();
        renderTasks();
      };

      targetEl.innerHTML = "";
      targetEl.classList.add("editing");
      targetEl.appendChild(input);
      input.focus();
      input.addEventListener("blur", saveEdit);
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") saveEdit();
      });
    }

    function addTask() {
      const input = document.getElementById("taskInput");
      const value = input.value.trim();
      if (value && completed.filter(c => !c).length < 6) {
        tasks.push(value);
        completed.push(false);
        saveTasks();
        input.value = "";
        renderTasks();
      }
    }

    function clearTasks() {
      if (confirm("Clear all tasks?")) {
        tasks = [];
        completed = [];
        localStorage.removeItem("tasks");
        localStorage.removeItem("completed");
        renderTasks();
      }
    }

    renderTasks();
  </script>
</body>
</html>
